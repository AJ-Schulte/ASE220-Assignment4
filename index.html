
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Tohoney - Shop</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="assets/images/favicon.png">
    <!-- Place favicon.ico in the root directory -->
    <!-- all css here -->
    <!-- bootstrap v3.3.7 css -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- owl.carousel.2.0.0-beta.2.4 css -->
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <!-- font-awesome v4.6.3 css -->
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <!-- flaticon.css -->
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <!-- jquery-ui.css -->
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <!-- metisMenu.min.css -->
    <link rel="stylesheet" href="assets/css/metisMenu.min.css">
    <!-- swiper.min.css -->
    <link rel="stylesheet" href="assets/css/swiper.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <!-- responsive css -->
    <link rel="stylesheet" href="assets/css/responsive.css">
    <!-- modernizr css -->
    <script src="assets/js/vendor/modernizr-2.8.3.min.js"></script>
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!--Start Preloader-->
    <div class="preloader-wrap">
        <div class="spinner"></div>
    </div>
   
    <!-- header-area start -->
    <header class="header-area">
        <div class="header-top bg-2">
            <div class="fluid-container">
                <div class="row">
                    <div class="col-md-6 col-12">
                        <ul class="d-flex header-contact">
                            <li><i class="fa fa-phone"></i> 013 123 4567</li>
                            <li><i class="fa fa-envelope"></i> domain@gmail.com</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom">
            <div class="fluid-container">
                <div class="row">
                    <div class="col-lg-3 col-md-7 col-sm-6 col-6">
                        <div class="logo">
                            <a href="index.html">
                        </a>
                        </div>
                    </div>
                    <div class="col-lg-7 d-none d-lg-block">
                        <nav class="mainmenu">
                            <ul class="d-flex">
                                <li>
                                    <a href="index.html">Shop</a>
                                </li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="col-md-4 col-lg-2 col-sm-5 col-4">
                        <ul class="search-cart-wrapper d-flex">
                            <li>
                                <a href="cart.html"><i class="flaticon-shop"></i> <span></span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- responsive-menu area start -->
            <div class="responsive-menu-area">
                <div class="container">
                    <div class="row">
                        <div class="col-12 d-block d-lg-none">
                            <ul class="metismenu">
                                <li>
                                    <a href="index.html">Home</a>
                                </li>
                                <li><a href="about.html">About</a></li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- responsive-menu area start -->
        </div>
    </header>
    <!-- header-area end -->
    <!-- .breadcumb-area start -->
    <!-- .breadcumb-area end -->
    <!-- product-area start -->
    <div class="product-area pt-100">
        <div class="container">
            <div class="row">
                <div class="col-sm-9 col-lg-10">
                    <div class="product-menu">
                        <ul class="nav">
                            <li>
                                <a class="active" href="newItem.html">Add product</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="all">
                    <ul class="row product-list">
                        <!-- Sample Product
                        <li class="col-xl-3 col-lg-4 col-sm-6 col-12">
                            <div class="product-wrap">
                                <div class="product-img">
                                    <img src="" alt="">
                                    <div class="product-icon flex-style">
                                        <ul>
                                            <li><a data-toggle="modal" data-target="#exampleModalCenter" href="javascript:void(0);"><i class="fa fa-eye"></i></a></li>
                                            <li><a href="cart.html"><i class="fa fa-shopping-bag"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product-content">
                                    <h3><a class="product-name" href="single-product.html"></a></h3>
                                    <p class="pull-left price">$</p>
                                    <button type="button" id="edit" class="active pull-right">Delete</button>
                                    <span class="pull-right">&nbsp;</span>
                                    <button type="button" id="edit" class="active pull-right">Update</button>
                                </div>
                            </div>
                        </li>
                        -->
                    </ul>
                    <div class="row pagination">
                        <div class="col-12">
                            <div class="pagination-wrapper text-center">
                                <ul class="page-numbers">
                                    <li><a id="prev-page" class="prev page-numbers" href="#"><i class="fa fa-angle-left"></i></a></li>
                                    <li><span id="page-number" class="page-numbers current" href="#">1</span></li>
                                    <li><a id="next-page" class="next page-numbers" href="#"><i class="fa fa-angle-right"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- product-area end -->
    <!-- start social-newsletter-section -->
    <section class="social-newsletter-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="newsletter text-center">
                        <h3>Subscribe  Newsletter</h3>
                        <div class="newsletter-form">
                            <form>
                                <input type="text" class="form-control" placeholder="Enter Your Email Address...">
                                <button type="submit"><i class="fa fa-send"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end container -->
    </section>
    <!-- end social-newsletter-section -->
    <!-- .footer-area start -->
    <div class="footer-area">
        <div class="footer-top">
            <div class="container">
                <div class="footer-top-item">
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <div class="footer-top-text text-center">
                                <ul>
                                    <li><a href="home.html">home</a></li>
                                    <li><a href="#">our story</a></li>
                                    <li><a href="#">feed shop</a></li>
                                    <li><a href="blog.html">how to eat blog</a></li>
                                    <li><a href="contact.html">contact</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <div class="row">
                    <div class="col-lg-2 col-md-3 col-sm-12">
                        <div class="footer-icon">
                            <ul class="d-flex">
                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                                <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-8 col-sm-12">
                        <div class="footer-content">
                            <p>On the other hand, we denounce with righteous indignation and dislike men who are so beguiled and demoralized by the charms of pleasure righteous indignation and dislike</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-8 col-sm-12">
                        <div class="footer-adress">
                            <ul>
                                <li><a href="#"><span>Email:</span> domain@gmail.com</a></li>
                                <li><a href="#"><span>Tel:</span> 0131234567</a></li>
                                <li><a href="#"><span>Adress:</span> 52 Web Bangale , Adress line2 , ip:3105</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-12">
                        <div class="footer-reserved">
                            <ul>
                                <li>Copyright © 2019 Tohoney All rights reserved.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- .footer-area end -->
    <!-- Modal area start -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="modal-body d-flex">
                    <div class="product-single-img w-50">
                        <img src="" alt="" id="modal-product-image"> 
                    </div>
                    <div class="product-single-content w-50">
                        <div id="modal-main">
                            <h3 class="name" id="modal-product-name"></h3>
                            <div class="rating-wrap fix">
                                <span class="pull-left price" id="modal-product-price"></span>
                                <span class="pull-right condition" id="modal-product-condition">Condition: </span>
                            </div>
                            <p class="description" id="modal-product-desctiption"></p>
                            <ul>
                                <li class="location pull-left" id="modal-product-location">Location: </li>
                                <li class="dateListed pull-right" id="modal-product-date">Date Listed: </li> 
                            </ul>
                            <br />
                            <ul class="input-style">
                                <li class="pull-right"><a id="cart-button" class="add-to-cart">Add to Cart</a></li>
                            </ul>
                            <ul class="cetagory">
                                <li>Categories:</li>
                                <li id="modal-product-category"></li>
                            </ul>
                            <ul class="socil-icon contact">
                                <li>Seller Contact Information:</li>
                                <li id="modal-seller-name">Name: </li>
                                <li id="modal-seller-email">Email: </li>
                            </ul>
                        </div>
                        <!-- Editable Form Section -->
                        <div id="edit-form" hidden>
                            <ul>
                                <li>
                                    <label for="edit-product-name">Product Name:</label>
                                    <input type="text" id="edit-product-name" class="form-control">
                                </li>
                                <li>
                                    <label for="edit-product-price">Product Price:</label>
                                    <input type="number" id="edit-product-price" class="form-control">
                                </li>
                                <li>
                                    <label for="edit-product-description">Description:</label>
                                    <textarea id="edit-product-description" class="form-control"></textarea>
                                </li>
                                <li>
                                    <label for="edit-product-location">Location:</label>
                                    <input type="text" id="edit-product-location" class="form-control">
                                </li>
                                <li>
                                    <label for="edit-product-category">Category:</label>
                                    <input type="text" id="edit-product-category" class="form-control">
                                </li>
                                <li>
                                    <a id="save-product-changes" class="form-control active loadmore-btn">Save Changes</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal area start -->
    <!-- index main script -->
    <!-- jquery latest version -->
    <script src="assets/js/vendor/jquery-2.2.4.min.js"></script>
    <!-- bootstrap js -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- owl.carousel.2.0.0-beta.2.4 css -->
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- mouse_scroll.js -->
    <script src="assets/js/mouse_scroll.js"></script>
    <!-- scrollup.js -->
    <script src="assets/js/scrollup.js"></script>
    <!-- isotope.pkgd.min.js -->
    <script src="assets/js/isotope.pkgd.min.js"></script>
    <!-- imagesloaded.pkgd.min.js -->
    <script src="assets/js/imagesloaded.pkgd.min.js"></script>
    <!-- jquery.zoom.min.js -->
    <script src="assets/js/jquery.zoom.min.js"></script>
    <!-- swiper.min.js -->
    <script src="assets/js/swiper.min.js"></script>
    <!-- metisMenu.min.js -->
    <script src="assets/js/metisMenu.min.js"></script>
    <!-- mailchimp.js -->
    <script src="assets/js/mailchimp.js"></script>
    <!-- jquery-ui.min.js -->
    <script src="assets/js/jquery-ui.min.js"></script>
    <!-- main js -->
    <script src="assets/js/scripts.js"></script>
    <script>
        const itemsPerPage = 8;  // Items per page
        let currentPage = 1;  // Start on page 1
        let allItems = []; // Store all items from the JSON
        const jsonURL = 'https://jsonblob.com/api/jsonBlob/1347697935206506496';

        // Function to load items from JSON
        function loadItems() {
            $.getJSON(jsonURL, function(data) {
                allItems = data.items; // Store all the items in an array
                showPage(currentPage);  // Show the first page when data is loaded
            }).fail(function() {
                console.log("Error loading the JSON data.");
            });
        }

        // Function to show items for the current page
        function showPage(pageNumber) {
            // Calculate the start and end index for the current page
            const startIndex = (pageNumber - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const itemsToShow = allItems.slice(startIndex, endIndex); // Get the items for this page

            // Clear the current product list
            $('.product-list').empty();

            // Add the items to the page
            itemsToShow.forEach(function(item) {
                const productHTML = `
                    <div class="col-xl-3 col-lg-4 col-sm-6 col-12">
                        <div class="product-wrap">
                            <div class="product-img">
                                <img src="${item.images[0]}" alt="${item.name}" style="width: 100%; height: auto;">
                                <div class="product-icon flex-style">
                                    <ul>
                                        <li><a class="view-product" data-id="${item.item_id}"><i class="fa fa-eye"></i></a></li>
                                        <li><a class="add-to-cart" data-id="${item.name}"><i class="fa fa-shopping-bag"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="product-content">
                                <h3><a>${item.name}</a></h3>
                                <p class="price">${item.currency}  $${item.price}</p>
                                <button type="button" class="active delete" data-id="${item.name}">Delete</button>
                                <button type="button" class="active update" data-id="${item.item_id}">Update</button>
                            </div>
                        </div>
                    </div>
                `;
                $('.product-list').append(productHTML);
            });

            // Update the page number text
            $('#page-number').text(`${pageNumber}`);
        }

        // Previous page button click
        $('#prev-page').click(function() {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        });

        // Next page button click
        $('#next-page').click(function() {
            const totalPages = Math.ceil(allItems.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                showPage(currentPage);
            }
        });

        // Initial load
        $(document).ready(function() {
            loadItems();

            $(document).on('click', '.view-product', function() {
                var productId = $(this).data('id');  // Get the product ID from the clicked element
                console.log('Product ID:', productId);  // Check if the ID is correct

                // Fetch product data from JSON
                $.ajax({
                    url: jsonURL,
                    method: 'GET',
                    success: function(data) {
                        // Find the product by item_id
                        var product = data.items.find(item => item.item_id === productId);
                        
                        document.getElementById('modal-main').removeAttribute("hidden");
                        document.getElementById('edit-form').hidden = true;

                        if (product) {
                            // Populate modal with product data
                            $('#modal-product-image').attr('src', product.images[0]);  // Product image
                            $('#modal-product-name').text(product.name);  // Product name
                            $('#modal-product-price').text(product.currency + ' $' + product.price);  // Product price
                            $('#modal-product-condition').text('Condition: ' + product.condition);  // Product condition
                            $('#modal-product-description').text(product.description);  // Product description
                            $('#modal-product-location').text('Location: ' + product.location);  // Product location
                            $('#modal-product-date').text('Date Listed: ' + product.date_listed);  // Date listed
                            $('#modal-product-category').text(product.category);  // Product category
                            $('#modal-seller-name').text('Name: ' + product.seller.name);  // Seller name
                            $('#modal-seller-email').text('Email: ' + product.seller.contact);  // Seller email
                            $('#cart-button').attr('data-id', product.name);

                            // Trigger the modal to open
                            $('#exampleModalCenter').modal('show');
                        } else {
                            console.log('Product not found');
                        }
                    },
                    error: function() {
                        console.log('Error loading product data.');
                    }
                });
            });

            $(document).on('click', '.add-to-cart', function() {
                var productId = $(this).data('id');

                $.ajax({
                    url: jsonURL,
                    type: 'GET',
                    success: function(data) {
                        updateCart(productId);
                        
                    }
                })
            });

            $(document).on('click', '.delete', function() {
                var productId = $(this).data('id');

                $.ajax({
                    url: jsonURL,
                    type: 'GET',
                    success: function(data) {
                        deleteItem(productId);
                    }
                })
            });

            // Fetch and open the modal with product details
            $(document).on('click', '.update', function () {
                const productId = $(this).data('id');
                
                // Fetch the product data from the JSON
                $.getJSON(jsonURL, function (data) {
                    const product = data.items.find(item => item.item_id === productId);

                    document.getElementById('edit-form').removeAttribute("hidden");
                    
                    document.getElementById('modal-main').hidden = true;

                    if (product) {
                        // Populate the modal with current product data
                        $('#modal-product-image').attr('src', product.images[0]);
                        $('#modal-product-name').text(product.name);
                        $('#modal-product-price').text(product.currency + ' $' + product.price);
                        $('#modal-product-condition').text('Condition: ' + product.condition);
                        $('#modal-product-description').text(product.description);
                        $('#modal-product-location').text('Location: ' + product.location);
                        $('#modal-product-date').text('Date Listed: ' + product.date_listed);
                        $('#modal-product-category').text(product.category);
                        $('#modal-seller-name').text('Name: ' + product.seller.name);
                        $('#modal-seller-email').text('Email: ' + product.seller.contact);
                        
                        // Pre-fill editable fields
                        $('#edit-product-name').val(product.name);
                        $('#edit-product-price').val(product.price);
                        $('#edit-product-description').val(product.description);
                        $('#edit-product-location').val(product.location);
                        $('#edit-product-category').val(product.category);

                        // Show the modal
                        $('#exampleModalCenter').modal('show');

                        // Save the updated product
                        $('#save-product-changes').on('click', function () {
                            const updatedProduct = {
                                item_id: product.item_id,
                                name: $('#edit-product-name').val(),
                                price: $('#edit-product-price').val(),
                                description: $('#edit-product-description').val(),
                                location: $('#edit-product-location').val(),
                                category: $('#edit-product-category').val(),
                                images: product.images,
                                currency: product.currency,
                                condition: product.condition,
                                date_listed: product.date_listed,
                                seller: product.seller
                            };

                            // Send updated product data to the server
                            $.ajax({
                                url: jsonURL,
                                method: 'PUT',
                                contentType: 'application/json',
                                data: JSON.stringify({ items: data.items.map(item => item.item_id === productId ? updatedProduct : item) }),
                                success: function (response) {
                                    alert("Product updated successfully!");
                                    location.reload(); // Refresh the page to show updated data
                                },
                                error: function () {
                                    alert("Error updating product.");
                                }
                            });
                        });
                    }
                });
            });

        });

        async function updateCart(productID) {
            const response = await fetch(jsonURL);
            const existingData = await response.json();
            let product;
            for(let i = 0; i < existingData.items.length; i++) {
                if(existingData.items[i].name == productID) {
                    console.log(existingData.items[i].name);
                    product = existingData.items[i];
                }
            };
            if(!product.in_cart) {
                product.in_cart = true;
                alert("You have added " + product.name + " to your cart.");
            } else {
                product.in_cart = false;
                alert("You have removed " + product.name + " from your cart.");
            }
            const updateResponse = await fetch(jsonURL, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(existingData)
            });

            const updatedData = await updateResponse.json();
        }

        // Delete item function 
        async function deleteItem(itemName) {
            const response = await fetch(jsonURL);
            const existingData = await response.json();
            console.log(itemName);

            for(let i = 0; i < existingData.items.length; i++) {
                if(existingData.items[i].name == itemName) {
                    console.log(existingData.items[i].name);
                    var deletedItem = existingData.items.splice(i, 1);
                }
            };
            
            console.log(existingData);

            alert(itemName + " has be deleted.");
            const updateResponse = await fetch(jsonURL, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(existingData)
            });
            location.reload();
        }
    </script>
</body>

</html>